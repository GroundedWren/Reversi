<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="Reversi player">
	<title>Reversi</title>

	<link href="./Styles/variables.css" rel="stylesheet" type="text/css">
	<link href="./Styles/main.css" rel="stylesheet" type="text/css">

	<script src="./Scripts/ActionBatcherGizmo.js"></script>
	<script src="./Scripts/SVGIconControl.js"></script>
	<script src="./Scripts/SwitchControl.js"></script>
	<script src="./Scripts/ToasterControl.js"></script>
	<script src="./Scripts/ShortcutsControl.js"></script>
	<script src="./Scripts/OptionListboxControl.js"></script>
	
	<script src="./Scripts/Display.js"></script>
	<script src="./Scripts/Reversi.js"></script>
	<script src="./Scripts/CellControl.js"></script>

	<link href="./Styles/index.css" rel="stylesheet" type="text/css">
	<script src="./Scripts/index.js"></script>
</head>
<body>
	<header>
		<div>
			<a class="hide-until-focus full" href="#main">Skip to content</a>
			<noscript><strong>This site may not function properly without JavaScript enabled.</strong></noscript>
			<a class="full" href="https://groundedwren.com/Pages/Games.html">Grounded Wren Games</a>
		</div>
		<div><h1>Reversi</h1></div>
		<div class="bubble-container">
			<button onclick="document.getElementById('diaInfo').showModal()">
				<gw-icon iconKey="circle-info" name="Instructions"></gw-icon>
			</button>
			<details class="bubbler">
				<summary>
					<gw-icon iconKey="gear" name="Settings"></gw-icon>
				</summary>
				<div class="bubble">
					<label>
						<gw-switch><input id="cbxDarkMode"
							type="checkbox"
							oninput="localStorage.setItem('theme', event.target.checked ? 'dark' : 'light');GW.Reversi.Display.updatePrefs();"
						></gw-switch>
						Dark mode
					</label>
				</div>
			</details>
			<button onclick="document.getElementById('diaNew').showModal()">New Game</button>
		</div>
	</header>
	<main id="main">
		<gw-shortcuts id="shortsGame"
			role="application"
			aria-labelledby="spnGameLbl"
			aria-describedby="asiGame"

			code_0="ArrowRight"
			handler_0="GW.Reversi.gameKbdNav(event)"
			info_0="Move right a column"

			code_1="ArrowLeft"
			handler_1="GW.Reversi.gameKbdNav(event)"
			info_1="Move left a column"

			code_2="ArrowUp"
			handler_2="GW.Reversi.gameKbdNav(event)"
			info_2="Move up a row"

			code_3="ArrowDown"
			handler_3="GW.Reversi.gameKbdNav(event)"
			info_3="Move down a column"

			code_4="PageUp"
			handler_4="GW.Reversi.gameBtnJump(event)"
			info_4="Jump to the previous button"

			code_5="PageDown"
			handler_5="GW.Reversi.gameBtnJump(event)"
			info_5="Jump to the next button"

			code_6="Control+Z"
			handler_6="GW.Reversi.undo(event)"
			info_6="Undo the last action"
		>
			<div id="divBoardContainer">
				<table id="tblBoard" 
					role="grid" 
					aria-labelledby="spnGameBoardLbl" 
					tabindex="0"
				></table>
			</div>
			<aside id="asiGame" style="visibility: hidden;">
				<gw-icon iconKey="keyboard" name="Keyboard navigation available"></gw-icon>
				<span class="sr-only">in focus mode</span>
				<span>(<kbd>Alt</kbd>+<kbd>S</kbd>)</span>
			</aside>
		</gw-shortcuts>
		<div>
			<article id="artInfo" aria-labelledby="hInfo">
				<h2 id="hInfo">Info</h2>
				<span id="spnStatus" tabindex="-1">
					<strong id="strBtm">Black</strong><strong id="strWtm">White</strong><span id="spnToMove">&nbsp;to move</span><span id="spnWins">&nbsp;wins!</span>
				</span>
				<gw-option-listbox id="olbPpc" data-single="true"><fieldset>
					<legend>Player's Piece Color</legend>
					<label><input id="radPpcB" type="radio" name="ppc" checked="true">Black</label>
					<label><input id="radPpcW" type="radio" name="ppc">White</label>
				</fieldset></gw-option-listbox>
				<table>
					<tbody>
						<tr>
							<th scope="row">Black:</th><td id="tdBlackCount"></td>
						</tr>
						<tr>
							<th scope="row">White:</th><td id="tdWhiteCount"></td>
						</tr>
						<tr>
							<th scope="row">Blank:</th><td id="tdBlankCount"></td>
						</tr>
					</tbody>
				</table>
				<button id="btnGrd" onclick="GW.Reversi.moveGreedily()">Greedy Move</button>
				<button id="btnUndo" onclick="GW.Reversi.undo()">Undo</button>
			</article>
		</div>
	</main>
	<footer>
		<figure>
			<a href="https://www.groundedwren.com/" target="_blank">
				<img src="./Img/gw-button.png" alt="Grounded Wren 88x31 Button; white text on a swirling purple, red, and black background">
			</a>
			<figcaption>Created by Vera in 2025</figcaption>
		</figure>
	</footer>
	<dialog id="diaInfo">
		<article>
			<gw-icon iconKey="circle-info" name="info" tabindex="-1" role="heading" aria-level="1" autofocus></gw-icon>
			<article>
				<h2>Intro</h2>
				<p>
					Welcome to the Grounded Wren Reversi player!
				</p>
				<p>
					Reversi dates back to the 1800s, and the <q>Othello</q> variant (used here) was codified in the 1970s.
					The rules are simple, but the skill ceiling is high - you have to plan ahead or a board seemingly covered by your pieces can reverse(i) in the blink of an eye!
				</p>
				<h2>How to Play</h2>
				<p>
					Reversi is played with two players - one uses <em>black</em> pieces, the other <em>white</em>.
					 Players take turns and move once per turn if they are able (and pass if they have no legal moves).
					 The game ends once there are no legal moves remaining (usually when the board is filled), and the player with more pieces on the board wins.
				</p>
				<p>
					To make a move, you must choose an empty cell in which to place one of your pieces. A cell is legal if you can follow a straight line of adjacent cells over your opponent's pieces back to your own.
					 Once your move is made, all the pieces in each of these lines are replaced with your pieces. (In a physical game, you would turn the pieces over to do this).
				</p>
				<p>
					You may take turns with someone if you are sharing a computer, or you may press the <q>Greedy Move</q> button on your opponent's turn to play against a simple bot.
				</p>
				<h2>Future Work</h2>
				<p>
					An online mode, so you can play remotely with a friend, is in the works.
				</p>
			</article>
			<footer>
				<a class="full" href="mailto:vera@groundedwren.com?subject=Reversi">Give feedback</a>
				<button onclick="document.getElementById('diaInfo').close();">Close</button>
			</footer>
		</article>
	</dialog>
	<dialog id="diaNew">
		<form aria-labelledby="hNew" onsubmit="GW.Reversi.onNewGame(event);document.getElementById('diaNew').close();">
			<h2 id="hNew">New Game</h2>
			<footer>
				<button type="submit">Begin</button>
				<button type="button" onclick="document.getElementById('diaNew').close()">Cancel</button>
			</footer>
		</form>
	</dialog>
	<div class="hidden">
		<span id="spnGameLbl">Reversi</span>
		<span id="spnGameBoardLbl">Board</span>
		<span id="spnCell">Cell</span>
		<span id="spnEmpty">Empty</span>
		<span id="spnBlackPiece">Black piece</span>
		<span id="spnWhitePiece">White piece</span>
		<span id="spnPlacePiece">Place piece</span>
		<span id="spnCellLastMove">Placed most recently</span>
		<span id="spnCellLastFlip">Flipped by the most recent move</span>
	</div>
</body>
</html>